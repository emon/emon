
# 
#  Error-correcting Multicast on Open Nodes (EMON)
#
#  This software is placed in public domain.
#

#
#  author(s): Yasutaka Atarashi <atarashi@mm.media.kyoto-u.ac.jp>
#             KOMURA Takaaki <komura@astem.or.jp>	
#             FUJIKAWA Kenji <fujikawa@real-internet.org>
#  started:   2001/05/17
#
#  $Id: Makefile.in,v 1.1 2008/09/26 15:10:34 emon Exp $
#

CC=gcc

CFLAGS=-Wall
CFLAGS+=-DDEBUG -DNO_PRINT @SDL_CFLAGS@

@SET_MAKE@
CFLAGS+=	@CFLAGS@ @CPPFLAGS@ @DEFS@
LDFLAGS=	@LDFLAGS@ @LIBS@

JPEGLIB=-L/usr/local/lib -ljpeg -L./jpegbuf -ljpegbuf
INCLUDES=-I/usr/local/include -I./jpegbuf

TARGETS=fecenc rtpenc udpsend \
	udprecv rtpdec fecdec jpegplay \
	rtpsend rtprecv \
	\
	jpegcat pipeerr pipesave pipeinfo filerepeat jpegsave\
	\
	audiocapt audioplay audiocaptplay

all: $(TARGETS)

getaddrinfo.o: compat/getaddrinfo.c
getnameinfo.o: compat/getnameinfo.c
net_addrcmp.o: compat/net_addrcmp.c

#
#  autoconf
#
AUTOCONF_ORIG=	configure.in acconfig.h Makefile.in
AUTOCONF_AGEN=	configure config.h.in
AUTOCONF_CONF=	config.h config.cache config.log config.status Makefile
AUTOCONF_TEMP=	confdefs.h

$(AUTOCONF_AGEN): $(AUTOCONF_ORIG)
	-chmod +w $(AUTOCONF_AGEN)
	autoconf
	autoheader
	chmod -w $(AUTOCONF_AGEN)

clean:
	rm -f $(TARGETS) *.o *~ *.core
	(cd jpegbuf; make clean)

config-clean:
	rm -f Makefile Makefile.bak config.cache config.h config.log config.status

depend:
	makedepend -- $(CFLAGS) -- *.c

fecenc: fecenc.o pipe_hd.o rs_emon.o libfec.o timeval.o debug.o
	$(CC) -o $@ $(LDFLAGS) $^ -lm

rtpenc: rtpenc.o rtp_hd.o debug.o timeval.o pipe_hd.o
	$(CC) -o $@ $(LDFLAGS) $^

udpsend: udpsend.o debug.o timeval.o pipe_hd.o sendsock_setup.o
	$(CC) -o $@ $(LDFLAGS) $^


rtpsend.o: rtpenc.c
	$(CC) -o $@ $(CFLAGS) -DRTPSEND $(CMPFLAGS) $(INCLUDES) -c rtpenc.c

rtpsend: rtpsend.o rtp_hd.o debug.o timeval.o pipe_hd.o sendsock_setup.o
	$(CC) -o $@ $(LDFLAGS) $^

rtprecv.o: rtpdec.c
	$(CC) -o $@ $(CFLAGS) -DRTPRECV $(CMPFLAGS) $(INCLUDES) -c rtpdec.c

rtprecv: rtprecv.o rtp_hd.o debug.o timeval.o pipe_hd.o multicast.o
	$(CC) -o $@ $(LDFLAGS) $^


udprecv: udprecv.o debug.o pipe_hd.o multicast.o
	$(CC) -o $@ $(LDFLAGS) $^

rtpdec: rtpdec.o rtp_hd.o debug.o timeval.o pipe_hd.o
	$(CC) -o $@ $(LDFLAGS) $^

fecdec: fecdec.o pipe_hd.o rs_emon.o libfec.o fec_decode.o timeval.o debug.o
	$(CC) -o $@ $(LDFLAGS) $^ -lm

jpegplay: jpegplay.o decoder_buf.o pipe_hd.o debug.o timeval.o decoder_buf.o
	(cd jpegbuf; make)
	$(CC) -o $@ $(LDFLAGS) @SDL_LIBS@ $^ \
	$(JPEGLIB)


jpegcat: jpegcat.o pipe_hd.o debug.o
	$(CC) -o $@ $(LDFLAGS) $^

pipesave: pipesave.o pipe_hd.o debug.o
	$(CC) -o $@ $(LDFLAGS) $^

jpegsave: jpegsave.o pipe_hd.o
	$(CC) -o $@ $(LDFLAGS) $^

pipeerr: pipeerr.o pipe_hd.o 
	$(CC) -o $@ $(LDFLAGS) $^

pipeinfo: pipeinfo.o pipe_hd.o debug.o
	$(CC) -o $@ $(LDFLAGS) $^

filerepeat: filerepeat.o pipe_hd.o debug.o timeval.o
	$(CC) -o $@ $(LDFLAGS) $^

audiocapt: audiocapt.o debug.o pipe_hd.o aucodec.o aucodec_l8l16.o aucodec_dvi4.o aucodec_pcmu.o time.o
	$(CC) -o $@ $(LDFLAGS) $^

audioplay: audioplay.o debug.o pipe_hd.o aucodec.o aucodec_l8l16.o aucodec_dvi4.o aucodec_pcmu.o timeval.o
	$(CC) -o $@ $(LDFLAGS) $^

audiocaptplay: audiocaptplay.o debug.o 
	$(CC) -o $@ $(LDFLAGS) $^

jpegcapt: jpegcapt.o debug.o pipe_hd.o capture.o timeval.o
	$(CC) -o $@ $(LDFLAGS) $^ $(JPEGLIB)

ntspwait: ntspwait.o ntsputil.o net_addrcmp.o
	$(CC) -o $@ $(LDFLAGS) $^

ntspcall: ntspcall.o ntsputil.o net_addrcmp.o
	$(CC) -o $@ $(LDFLAGS) $^
